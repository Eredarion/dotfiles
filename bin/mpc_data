#!/bin/bash

IMG_REG="(front|cover|art)\.(jpg|jpeg|png|gif)$"
DEFAULT_ART="$HOME/.config/awesome/themes/skyfall/icons/music.png"

# determine file
file="$(mpc current -f %file%)"

# check if anything is playing at all
[[ -z $file ]] && exit 1

# Get all info
info="$(mpc -f "%artist%@@%title%@")"

# Art directory
art="$HOME/Music/${file%/*}"

# skip if the art directory does not exist (mpd is playing a stream, etc)
if [[ -d $art ]]; then
    # find every file that matches IMG_REG set the first matching file to be the cover.
    cover="$(find "$art/" -maxdepth 1 -type f | egrep -i -m1 "$IMG_REG")"
fi

# when no cover is found, use DEFAULT_ART as cover
cover="${cover:=$DEFAULT_ART}"

#echo $title"@@"$song"@#"$cover"#@"
echo $info"##"$cover"##"
